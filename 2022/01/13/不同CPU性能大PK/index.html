<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="海光,超线程,ADM,Zen,hygon," />





  <link rel="alternate" href="/atom.xml" title="plantegg" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="不同CPU性能大PK前言比较Hygon7280、Intel、AMD、鲲鹏920、飞腾2500的性能情况    CPU型号 Hygon 7280 AMD EPYC 7H12 Intel 8163 鲲鹏920 飞腾2500     物理核数 32 32 24 48 64   超线程 2 2 2     路 2 2 2 2 2   NUMA Node 8 2 2 4 16   L1d 32K 32K 3">
<meta name="keywords" content="海光,超线程,ADM,Zen,hygon">
<meta property="og:type" content="article">
<meta property="og:title" content="不同CPU性能大PK">
<meta property="og:url" content="https://plantegg.github.io/2022/01/13/不同CPU性能大PK/index.html">
<meta property="og:site_name" content="plantegg">
<meta property="og:description" content="不同CPU性能大PK前言比较Hygon7280、Intel、AMD、鲲鹏920、飞腾2500的性能情况    CPU型号 Hygon 7280 AMD EPYC 7H12 Intel 8163 鲲鹏920 飞腾2500     物理核数 32 32 24 48 64   超线程 2 2 2     路 2 2 2 2 2   NUMA Node 8 2 2 4 16   L1d 32K 32K 3">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20211231202402561.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210823082702539.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210817181752243.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210924185044090.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220323153507557.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20211228165542167.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221113929547.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112527936.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112727377.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112853404.png">
<meta property="og:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221113037332.png">
<meta property="og:updated_time" content="2022-04-13T09:55:46.241Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="不同CPU性能大PK">
<meta name="twitter:description" content="不同CPU性能大PK前言比较Hygon7280、Intel、AMD、鲲鹏920、飞腾2500的性能情况    CPU型号 Hygon 7280 AMD EPYC 7H12 Intel 8163 鲲鹏920 飞腾2500     物理核数 32 32 24 48 64   超线程 2 2 2     路 2 2 2 2 2   NUMA Node 8 2 2 4 16   L1d 32K 32K 3">
<meta name="twitter:image" content="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20211231202402561.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://plantegg.github.io/2022/01/13/不同CPU性能大PK/"/>





  <title>不同CPU性能大PK | plantegg</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">plantegg</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">java tcp mysql performance network docker Linux</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-categories"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2022/01/13/不同CPU性能大PK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weibo @plantegg">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">不同CPU性能大PK</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-13T17:30:03+08:00">
                2022-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CPU/" itemprop="url" rel="index">
                    <span itemprop="name">CPU</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="不同CPU性能大PK"><a href="#不同CPU性能大PK" class="headerlink" title="不同CPU性能大PK"></a>不同CPU性能大PK</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>比较Hygon7280、Intel、AMD、鲲鹏920、飞腾2500的性能情况</p>
<table>
<thead>
<tr>
<th>CPU型号</th>
<th>Hygon 7280</th>
<th>AMD EPYC 7H12</th>
<th>Intel 8163</th>
<th>鲲鹏920</th>
<th>飞腾2500</th>
</tr>
</thead>
<tbody>
<tr>
<td>物理核数</td>
<td>32</td>
<td>32</td>
<td>24</td>
<td>48</td>
<td>64</td>
</tr>
<tr>
<td>超线程</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>路</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>NUMA Node</td>
<td>8</td>
<td>2</td>
<td>2</td>
<td>4</td>
<td>16</td>
</tr>
<tr>
<td>L1d</td>
<td>32K</td>
<td>32K</td>
<td>32K</td>
<td>64K</td>
<td>32K</td>
</tr>
<tr>
<td>L2</td>
<td>512K</td>
<td>512K</td>
<td>1024K</td>
<td>512K</td>
<td>2048K</td>
</tr>
</tbody>
</table>
<h2 id="参与比较的几款CPU参数"><a href="#参与比较的几款CPU参数" class="headerlink" title="参与比较的几款CPU参数"></a>参与比较的几款CPU参数</h2><p>IPC的说明：</p>
<blockquote>
<p>IPC: insns per cycle  insn/cycles  也就是每个时钟周期能执行的指令数量，越大程序跑的越快</p>
<p>程序的执行时间 = 指令数/(主频*IPC) //单核下，多核的话再除以核数</p>
</blockquote>
<h3 id="Hygon-7280"><a href="#Hygon-7280" class="headerlink" title="Hygon 7280"></a>Hygon 7280</h3><p>Hygon 7280 就是AMD Zen架构，最大IPC能到5. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">架构：                           x86_64</div><div class="line">CPU 运行模式：                   32-bit, 64-bit</div><div class="line">字节序：                         Little Endian</div><div class="line">Address sizes:                   43 bits physical, 48 bits virtual</div><div class="line">CPU:                             128</div><div class="line">在线 CPU 列表：                  0-127</div><div class="line">每个核的线程数：                 2</div><div class="line">每个座的核数：                   32</div><div class="line">座：                             2</div><div class="line">NUMA 节点：                      8</div><div class="line">厂商 ID：                        HygonGenuine</div><div class="line">CPU 系列：                       24</div><div class="line">型号：                           1</div><div class="line">型号名称：                       Hygon C86 7280 32-core Processor</div><div class="line">步进：                           1</div><div class="line">CPU MHz：                        2194.586</div><div class="line">BogoMIPS：                       3999.63</div><div class="line">虚拟化：                         AMD-V</div><div class="line">L1d 缓存：                       2 MiB</div><div class="line">L1i 缓存：                       4 MiB</div><div class="line">L2 缓存：                        32 MiB</div><div class="line">L3 缓存：                        128 MiB</div><div class="line">NUMA 节点0 CPU：                 0-7,64-71</div><div class="line">NUMA 节点1 CPU：                 8-15,72-79</div><div class="line">NUMA 节点2 CPU：                 16-23,80-87</div><div class="line">NUMA 节点3 CPU：                 24-31,88-95</div><div class="line">NUMA 节点4 CPU：                 32-39,96-103</div><div class="line">NUMA 节点5 CPU：                 40-47,104-111</div><div class="line">NUMA 节点6 CPU：                 48-55,112-119</div><div class="line">NUMA 节点7 CPU：                 56-63,120-127</div></pre></td></tr></table></figure>
<p>曙光H620-G30A 机型硬件结构，CPU是hygon 7280（截图只截取了Socket0）</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20211231202402561.png" alt="image-20211231202402561"></p>
<h3 id="AMD-EPYC-7H12"><a href="#AMD-EPYC-7H12" class="headerlink" title="AMD EPYC 7H12"></a>AMD EPYC 7H12</h3><p>AMD EPYC 7H12 64-Core（ECS，非物理机），最大IPC能到5. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> lscpu</span></div><div class="line">Architecture:          x86_64</div><div class="line">CPU op-mode(s):        32-bit, 64-bit</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                64</div><div class="line">On-line CPU(s) list:   0-63</div><div class="line">Thread(s) per core:    2</div><div class="line">Core(s) per socket:    16</div><div class="line">座：                 2</div><div class="line">NUMA 节点：         2</div><div class="line">厂商 ID：           AuthenticAMD</div><div class="line">CPU 系列：          23</div><div class="line">型号：              49</div><div class="line">型号名称：        AMD EPYC 7H12 64-Core Processor</div><div class="line">步进：              0</div><div class="line">CPU MHz：             2595.124</div><div class="line">BogoMIPS：            5190.24</div><div class="line">虚拟化：           AMD-V</div><div class="line">超管理器厂商：  KVM</div><div class="line">虚拟化类型：     完全</div><div class="line">L1d 缓存：          32K</div><div class="line">L1i 缓存：          32K</div><div class="line">L2 缓存：           512K</div><div class="line">L3 缓存：           16384K</div><div class="line">NUMA 节点0 CPU：    0-31</div><div class="line">NUMA 节点1 CPU：    32-63</div></pre></td></tr></table></figure>
<h3 id="Intel-8163"><a href="#Intel-8163" class="headerlink" title="Intel 8163"></a>Intel 8163</h3><p>这次对比测试的Intel 8163 CPU信息如下，最大IPC 是4：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">lscpu</span></div><div class="line">Architecture:          x86_64</div><div class="line">CPU op-mode(s):        32-bit, 64-bit</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                96</div><div class="line">On-line CPU(s) list:   0-95</div><div class="line">Thread(s) per core:    2</div><div class="line">Core(s) per socket:    24</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          1</div><div class="line">Vendor ID:             GenuineIntel</div><div class="line">CPU family:            6</div><div class="line">Model:                 85</div><div class="line">Model name:            Intel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHz</div><div class="line">Stepping:              4</div><div class="line">CPU MHz:               2499.121</div><div class="line">CPU max MHz:           3100.0000</div><div class="line">CPU min MHz:           1000.0000</div><div class="line">BogoMIPS:              4998.90</div><div class="line">Virtualization:        VT-x</div><div class="line">L1d cache:             32K</div><div class="line">L1i cache:             32K</div><div class="line">L2 cache:              1024K</div><div class="line">L3 cache:              33792K</div><div class="line">NUMA node0 CPU(s):     0-95</div><div class="line"></div><div class="line">-----8269CY</div><div class="line"><span class="meta">#</span><span class="bash">lscpu</span></div><div class="line">Architecture:          x86_64</div><div class="line">CPU op-mode(s):        32-bit, 64-bit</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                104</div><div class="line">On-line CPU(s) list:   0-103</div><div class="line">Thread(s) per core:    2</div><div class="line">Core(s) per socket:    26</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          2</div><div class="line">Vendor ID:             GenuineIntel</div><div class="line">CPU family:            6</div><div class="line">Model:                 85</div><div class="line">Model name:            Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz</div><div class="line">Stepping:              7</div><div class="line">CPU MHz:               3200.000</div><div class="line">CPU max MHz:           3800.0000</div><div class="line">CPU min MHz:           1200.0000</div><div class="line">BogoMIPS:              4998.89</div><div class="line">Virtualization:        VT-x</div><div class="line">L1d cache:             32K</div><div class="line">L1i cache:             32K</div><div class="line">L2 cache:              1024K</div><div class="line">L3 cache:              36608K</div><div class="line">NUMA node0 CPU(s):     0-25,52-77</div><div class="line">NUMA node1 CPU(s):     26-51,78-103</div></pre></td></tr></table></figure>
<h3 id="鲲鹏920"><a href="#鲲鹏920" class="headerlink" title="鲲鹏920"></a>鲲鹏920</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">[root@ARM 19:15 /root/lmbench3]</div><div class="line">#numactl -H</div><div class="line">available: 4 nodes (0-3)</div><div class="line">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</div><div class="line">node 0 size: 192832 MB</div><div class="line">node 0 free: 146830 MB</div><div class="line">node 1 cpus: 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47</div><div class="line">node 1 size: 193533 MB</div><div class="line">node 1 free: 175354 MB</div><div class="line">node 2 cpus: 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71</div><div class="line">node 2 size: 193533 MB</div><div class="line">node 2 free: 175718 MB</div><div class="line">node 3 cpus: 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95</div><div class="line">node 3 size: 193532 MB</div><div class="line">node 3 free: 183643 MB</div><div class="line">node distances:</div><div class="line">node   0   1   2   3</div><div class="line">  0:  10  12  20  22</div><div class="line">  1:  12  10  22  24</div><div class="line">  2:  20  22  10  12</div><div class="line">  3:  22  24  12  10</div><div class="line">  </div><div class="line">  #lscpu</div><div class="line">Architecture:          aarch64</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                96</div><div class="line">On-line CPU(s) list:   0-95</div><div class="line">Thread(s) per core:    1</div><div class="line">Core(s) per socket:    48</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          4</div><div class="line">Model:                 0</div><div class="line">CPU max MHz:           2600.0000</div><div class="line">CPU min MHz:           200.0000</div><div class="line">BogoMIPS:              200.00</div><div class="line">L1d cache:             64K</div><div class="line">L1i cache:             64K</div><div class="line">L2 cache:              512K</div><div class="line">L3 cache:              24576K</div><div class="line">NUMA node0 CPU(s):     0-23</div><div class="line">NUMA node1 CPU(s):     24-47</div><div class="line">NUMA node2 CPU(s):     48-71</div><div class="line">NUMA node3 CPU(s):     72-95</div><div class="line">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm</div></pre></td></tr></table></figure>
<h3 id="飞腾2500"><a href="#飞腾2500" class="headerlink" title="飞腾2500"></a>飞腾2500</h3><p>飞腾2500用nop去跑IPC的话，只能到1，但是跑其它代码能到2.33</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">lscpu</span></div><div class="line">Architecture:          aarch64</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                128</div><div class="line">On-line CPU(s) list:   0-127</div><div class="line">Thread(s) per core:    1</div><div class="line">Core(s) per socket:    64</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          16</div><div class="line">Model:                 3</div><div class="line">BogoMIPS:              100.00</div><div class="line">L1d cache:             32K</div><div class="line">L1i cache:             32K</div><div class="line">L2 cache:              2048K</div><div class="line">L3 cache:              65536K</div><div class="line">NUMA node0 CPU(s):     0-7</div><div class="line">NUMA node1 CPU(s):     8-15</div><div class="line">NUMA node2 CPU(s):     16-23</div><div class="line">NUMA node3 CPU(s):     24-31</div><div class="line">NUMA node4 CPU(s):     32-39</div><div class="line">NUMA node5 CPU(s):     40-47</div><div class="line">NUMA node6 CPU(s):     48-55</div><div class="line">NUMA node7 CPU(s):     56-63</div><div class="line">NUMA node8 CPU(s):     64-71</div><div class="line">NUMA node9 CPU(s):     72-79</div><div class="line">NUMA node10 CPU(s):    80-87</div><div class="line">NUMA node11 CPU(s):    88-95</div><div class="line">NUMA node12 CPU(s):    96-103</div><div class="line">NUMA node13 CPU(s):    104-111</div><div class="line">NUMA node14 CPU(s):    112-119</div><div class="line">NUMA node15 CPU(s):    120-127</div><div class="line">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</div><div class="line"><span class="meta"></span></div><div class="line">#<span class="bash">perf <span class="built_in">stat</span> ./nop</span></div><div class="line">failed to read counter stalled-cycles-frontend</div><div class="line">failed to read counter stalled-cycles-backend</div><div class="line">failed to read counter branches</div><div class="line"></div><div class="line"> Performance counter stats for './nop':</div><div class="line"></div><div class="line">      78638.700540      task-clock (msec)         #    0.999 CPUs utilized</div><div class="line">              1479      context-switches          #    0.019 K/sec</div><div class="line">                55      cpu-migrations            #    0.001 K/sec</div><div class="line">                37      page-faults               #    0.000 K/sec</div><div class="line">      165127619524      cycles                    #    2.100 GHz</div><div class="line">   &lt;not supported&gt;      stalled-cycles-frontend</div><div class="line">   &lt;not supported&gt;      stalled-cycles-backend</div><div class="line">      165269372437      instructions              #    1.00  insns per cycle</div><div class="line">   &lt;not supported&gt;      branches</div><div class="line">           3057191      branch-misses             #    0.00% of all branches</div><div class="line"></div><div class="line">      78.692839007 seconds time elapsed</div><div class="line">      </div><div class="line"><span class="meta">#</span><span class="bash">dmidecode -t processor</span></div><div class="line"><span class="meta">#</span><span class="bash"> dmidecode 3.0</span></div><div class="line">Getting SMBIOS data from sysfs.</div><div class="line">SMBIOS 3.2.0 present.</div><div class="line"><span class="meta">#</span><span class="bash"> SMBIOS implementations newer than version 3.0 are not</span></div><div class="line"><span class="meta">#</span><span class="bash"> fully supported by this version of dmidecode.</span></div><div class="line"></div><div class="line">Handle 0x0004, DMI type 4, 48 bytes</div><div class="line">Processor Information</div><div class="line">	Socket Designation: BGA3576</div><div class="line">	Type: Central Processor</div><div class="line">	Family: &lt;OUT OF SPEC&gt;</div><div class="line">	Manufacturer: PHYTIUM</div><div class="line">	ID: 00 00 00 00 70 1F 66 22</div><div class="line">	Version: S2500</div><div class="line">	Voltage: 0.8 V</div><div class="line">	External Clock: 50 MHz</div><div class="line">	Max Speed: 2100 MHz</div><div class="line">	Current Speed: 2100 MHz</div><div class="line">	Status: Populated, Enabled</div><div class="line">	Upgrade: Other</div><div class="line">	L1 Cache Handle: 0x0005</div><div class="line">	L2 Cache Handle: 0x0007</div><div class="line">	L3 Cache Handle: 0x0008</div><div class="line">	Serial Number: N/A</div><div class="line">	Asset Tag: No Asset Tag</div><div class="line">	Part Number: NULL</div><div class="line">	Core Count: 64</div><div class="line">	Core Enabled: 64</div><div class="line">	Thread Count: 64</div><div class="line">	Characteristics:</div><div class="line">		64-bit capable</div><div class="line">		Multi-Core</div><div class="line">		Hardware Thread</div><div class="line">		Execute Protection</div><div class="line">		Enhanced Virtualization</div><div class="line">		Power/Performance Control</div></pre></td></tr></table></figure>
<h2 id="单核以及HT计算Prime性能比较"><a href="#单核以及HT计算Prime性能比较" class="headerlink" title="单核以及HT计算Prime性能比较"></a>单核以及HT计算Prime性能比较</h2><p>以上两款CPU但从物理上的指标来看似乎AMD要好很多，从工艺上AMD也要领先一代(2年），从单核参数上来说是2.0 VS 2.5GHz，但是IPC 是5 VS 4，算下来理想的单核性能刚好一致（2<em>5=2.5 </em>4）。</p>
<p>从外面的一些跑分结果显示也是AMD 要好，但是实际性能怎么样呢？</p>
<p>测试命令，这个测试命令无论在哪个CPU下，用2个物理核用时都是一个物理核的一半，所以这个计算是可以完全并行的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">taskset -c 1 /usr/bin/sysbench --num-threads=1 --test=cpu --cpu-max-prime=50000 run //单核用一个threads，绑核; HT用2个threads，绑一对HT</div></pre></td></tr></table></figure>
<p>测试结果为耗时，单位秒</p>
<table>
<thead>
<tr>
<th style="text-align:left">测试项</th>
<th>AMD EPYC 7H12 2.5G CentOS 7.9</th>
<th>Hygon 7280 2.1GHz CentOS</th>
<th style="text-align:left">Hygon 7280 2.1GHz 麒麟</th>
<th>Intel 8269 2.50G</th>
<th style="text-align:left">Intel 8163 CPU @ 2.50GHz</th>
<th style="text-align:left">Intel E5-2682 v4 @ 2.50GHz</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">单核  prime 50000 耗时</td>
<td>59秒  IPC 0.56</td>
<td>77秒 IPC 0.55</td>
<td style="text-align:left">89秒  IPC 0.56;</td>
<td>83 0.41</td>
<td style="text-align:left">105秒  IPC 0.41</td>
<td style="text-align:left">109秒  IPC 0.39</td>
</tr>
<tr>
<td style="text-align:left">HT  prime 50000 耗时</td>
<td>57秒  IPC 0.31</td>
<td>74秒 IPC 0.29</td>
<td style="text-align:left">87秒  IPC 0.29</td>
<td>48 0.35</td>
<td style="text-align:left">60秒   IPC 0.36</td>
<td style="text-align:left">74秒    IPC 0.29</td>
</tr>
</tbody>
</table>
<p>相同CPU下的 指令数 基本= 耗时 <em> IPC </em> 核数</p>
<p>以上测试结果显示Hygon 7280单核计算能力是要强过Intel 8163的，但是超线程在这个场景下太不给力，相当于没有。</p>
<p>当然上面的计算Prime太单纯了，代表不了复杂的业务场景，所以接下来用MySQL的查询场景来看看。</p>
<p>如果是arm芯片在计算prime上明显要好过x86，猜测是除法取余指令上有优化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#taskset -c 11 sysbench cpu --threads=1 --events=50000  run</div><div class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</div></pre></td></tr></table></figure>
<p>测试结果为10秒钟的event</p>
<table>
<thead>
<tr>
<th style="text-align:left">测试项</th>
<th>FT2500 2.1G</th>
<th>鲲鹏920-4826 2.6GHz</th>
<th style="text-align:left">Intel 8163 CPU @ 2.50GHz</th>
<th>Hygon C86 7280 2.1GHz</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">单核  prime 10秒 events</td>
<td>21626  IPC 0.89</td>
<td>30299 IPC 1.01</td>
<td style="text-align:left">8435  IPC 0.41</td>
<td>10349  IPC 0.63</td>
</tr>
</tbody>
</table>
<h2 id="对比MySQL-sysbench和tpcc性能"><a href="#对比MySQL-sysbench和tpcc性能" class="headerlink" title="对比MySQL sysbench和tpcc性能"></a>对比MySQL sysbench和tpcc性能</h2><p>分别将MySQL 5.7.34社区版部署到intel+AliOS以及hygon 7280+CentOS上，将mysqld绑定到单核，一样的压力配置均将CPU跑到100%，然后用sysbench测试点查， HT表示将mysqld绑定到一对HT核。</p>
<h3 id="sysbench点查"><a href="#sysbench点查" class="headerlink" title="sysbench点查"></a>sysbench点查</h3><p> 测试命令类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysbench --test=&apos;/usr/share/doc/sysbench/tests/db/select.lua&apos; --oltp_tables_count=1 --report-interval=1 --oltp-table-size=10000000  --mysql-port=3307 --mysql-db=sysbench_single --mysql-user=root --mysql-password=&apos;Bj6f9g96!@#&apos;  --max-requests=0   --oltp_skip_trx=on --oltp_auto_inc=on  --oltp_range_size=5  --mysql-table-engine=innodb --rand-init=on   --max-time=300 --mysql-host=x86.51 --num-threads=4 run</div></pre></td></tr></table></figure>
<p>测试结果(测试中的差异AMD、Hygon CPU跑在CentOS7.9， intel CPU、Kunpeng 920 跑在AliOS上, xdb表示用集团的xdb替换社区的MySQL Server， 麒麟是国产OS)：</p>
<table>
<thead>
<tr>
<th style="text-align:left">测试核数</th>
<th>AMD EPYC 7H12 2.5G</th>
<th style="text-align:left">Hygon 7280 2.1G</th>
<th>Hygon 7280 2.1GHz 麒麟</th>
<th>Intel 8269 2.50G</th>
<th style="text-align:left">Intel 8163 2.50G</th>
<th style="text-align:left">Intel 8163 2.50G XDB5.7</th>
<th>鲲鹏 920-4826 2.6G</th>
<th>鲲鹏 920-4826 2.6G XDB8.0</th>
<th>FT2500 alisql 8.0 本地–socket</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">单核</td>
<td>24674  0.54</td>
<td style="text-align:left">13441  0.46</td>
<td>10236  0.39</td>
<td>28208 0.75</td>
<td style="text-align:left">25474   0.84</td>
<td style="text-align:left">29376    0.89</td>
<td>9694  0.49</td>
<td>8301  0.46</td>
<td>3602 0.53</td>
</tr>
<tr>
<td style="text-align:left">一对HT</td>
<td>36157 0.42</td>
<td style="text-align:left">21747  0.38</td>
<td>19417  0.37</td>
<td>36754 0.49</td>
<td style="text-align:left">35894  0.6</td>
<td style="text-align:left">40601  0.65</td>
<td>无HT</td>
<td>无HT</td>
<td>无HT</td>
</tr>
<tr>
<td style="text-align:left">4物理核</td>
<td>94132 0.52</td>
<td style="text-align:left">49822 0.46</td>
<td>38033  0.37</td>
<td>90434 0.69 350%</td>
<td style="text-align:left">87254  0.73</td>
<td style="text-align:left">106472  0.83</td>
<td>34686  0.42</td>
<td>28407  0.39</td>
<td>14232 0.53</td>
</tr>
<tr>
<td style="text-align:left">16物理核</td>
<td>325409 0.48</td>
<td style="text-align:left">171630 0.38</td>
<td>134980  0.34</td>
<td>371718 0.69 1500%</td>
<td style="text-align:left">332967  0.72</td>
<td style="text-align:left">446290  0.85 //16核比4核好！</td>
<td>116122  0.35</td>
<td>94697  0.33</td>
<td>59199  0.6  8core:31210 0.59</td>
</tr>
<tr>
<td style="text-align:left">32物理核</td>
<td>542192 0.43</td>
<td style="text-align:left">298716 0.37</td>
<td>255586  0.33</td>
<td>642548 0.64 2700%</td>
<td style="text-align:left">588318  0.67</td>
<td style="text-align:left">598637  0.81 CPU 2400%</td>
<td>228601  0.36</td>
<td>177424  0.32</td>
<td>114020 0.65</td>
</tr>
</tbody>
</table>
<ul>
<li>麒麟OS下CPU很难跑满，大致能跑到90%-95%左右，麒麟上装的社区版MySQL-5.7.29；飞腾要特别注意mysqld所在socket，同时以上飞腾数据都是走–socket压测锁的，32core走网络压测QPS为：99496（15%的网络损耗）[^说明]</li>
</ul>
<h3 id="Mysqld-二进制代码所在-page-cache带来的性能影响"><a href="#Mysqld-二进制代码所在-page-cache带来的性能影响" class="headerlink" title="Mysqld 二进制代码所在 page cache带来的性能影响"></a>Mysqld 二进制代码所在 page cache带来的性能影响</h3><p>如果是飞腾跨socket影响很大，mysqld二进制跨socket性能会下降30%以上</p>
<p>对于鲲鹏920，双路服务器上测试，mysqld绑在node0, 但是分别将mysqld二进制load进不同的node上的page cache，然后执行点查</p>
<table>
<thead>
<tr>
<th>mysqld</th>
<th>node0</th>
<th>node1</th>
<th>node2</th>
<th>node3</th>
</tr>
</thead>
<tbody>
<tr>
<td>QPS</td>
<td>190120 IPC 0.40</td>
<td>182518 IPC 0.39</td>
<td>189046 IPC 0.40</td>
<td>186533 IPC 0.40</td>
</tr>
</tbody>
</table>
<p>以上数据可以看出这里node0到node1还是很慢的，居然比跨socket还慢，反过来说鲲鹏跨socket性能很好</p>
<p>绑定mysqld到不同node的page cache操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">#systemctl stop mysql-server</div><div class="line"></div><div class="line">[root@poc65 /root/vmtouch]</div><div class="line">#vmtouch -e /usr/local/mysql/bin/mysqld</div><div class="line">           Files: 1</div><div class="line">     Directories: 0</div><div class="line">   Evicted Pages: 5916 (23M)</div><div class="line">         Elapsed: 0.00322 seconds</div><div class="line"></div><div class="line">#vmtouch -v /usr/local/mysql/bin/mysqld</div><div class="line">/usr/local/mysql/bin/mysqld</div><div class="line">[                                                            ] 0/5916</div><div class="line"></div><div class="line">           Files: 1</div><div class="line">     Directories: 0</div><div class="line">  Resident Pages: 0/5916  0/23M  0%</div><div class="line">         Elapsed: 0.000204 seconds</div><div class="line"></div><div class="line">#taskset -c 24 md5sum /usr/local/mysql/bin/mysqld</div><div class="line"></div><div class="line">#grep mysqld /proc/`pidof mysqld`/numa_maps  //检查mysqld具体绑定在哪个node上</div><div class="line">00400000 default file=/usr/local/mysql/bin/mysqld mapped=3392 active=1 N0=3392 kernelpagesize_kB=4</div><div class="line">0199b000 default file=/usr/local/mysql/bin/mysqld anon=10 dirty=10 mapped=134 active=10 N0=134 kernelpagesize_kB=4</div><div class="line">01a70000 default file=/usr/local/mysql/bin/mysqld anon=43 dirty=43 mapped=120 active=43 N0=120 kernelpagesize_kB=4</div></pre></td></tr></table></figure>
<h3 id="网卡以及node距离带来的性能差异"><a href="#网卡以及node距离带来的性能差异" class="headerlink" title="网卡以及node距离带来的性能差异"></a>网卡以及node距离带来的性能差异</h3><p>在鲲鹏920+mysql5.7+alios，将内存分配锁在node0上，然后分别绑核在1、24、48、72core，进行sysbench点查对比</p>
<table>
<thead>
<tr>
<th></th>
<th>Core1</th>
<th>Core24</th>
<th>Core48</th>
<th>Core72</th>
</tr>
</thead>
<tbody>
<tr>
<td>QPS</td>
<td>10800</td>
<td>10400</td>
<td>7700</td>
<td>7700</td>
</tr>
</tbody>
</table>
<p>以上测试的时候业务进程分配的内存全限制在node0上（下面的网卡中断测试也是同样内存结构）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#/root/numa-maps-summary.pl &lt;/proc/123853/numa_maps</div><div class="line">N0        :      5085548 ( 19.40 GB)</div><div class="line">N1        :         4479 (  0.02 GB)</div><div class="line">N2        :            1 (  0.00 GB)</div><div class="line">active    :            0 (  0.00 GB)</div><div class="line">anon      :      5085455 ( 19.40 GB)</div><div class="line">dirty     :      5085455 ( 19.40 GB)</div><div class="line">kernelpagesize_kB:         2176 (  0.01 GB)</div><div class="line">mapmax    :          348 (  0.00 GB)</div><div class="line">mapped    :         4626 (  0.02 GB)</div></pre></td></tr></table></figure>
<p>对比测试，将内存锁在node3上，重复进行以上测试结果如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>Core1</th>
<th>Core24</th>
<th>Core48</th>
<th>Core72</th>
</tr>
</thead>
<tbody>
<tr>
<td>QPS</td>
<td>10500</td>
<td>10000</td>
<td>8100</td>
<td>8000</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#/root/numa-maps-summary.pl &lt;/proc/54478/numa_maps</div><div class="line">N0        :           16 (  0.00 GB)</div><div class="line">N1        :         4401 (  0.02 GB)</div><div class="line">N2        :            1 (  0.00 GB)</div><div class="line">N3        :      1779989 (  6.79 GB)</div><div class="line">active    :            0 (  0.00 GB)</div><div class="line">anon      :      1779912 (  6.79 GB)</div><div class="line">dirty     :      1779912 (  6.79 GB)</div><div class="line">kernelpagesize_kB:         1108 (  0.00 GB)</div><div class="line">mapmax    :          334 (  0.00 GB)</div><div class="line">mapped    :         4548 (  0.02 GB)</div></pre></td></tr></table></figure>
<p>机器上网卡eth1插在node0上，由以上两组对比测试发现网卡影响比内存跨node影响更大，网卡影响有20%。而内存的影响基本看不到（就近好那么一点点，但是不明显，只能解释为cache命中率很高了）</p>
<p>此时软中断都在node0上，如果将软中断绑定到node3上，第72core的QPS能提升到8500，并且非常稳定。同时core0的QPS下降到10000附近。</p>
<h4 id="网卡软中断以及网卡远近的测试结论"><a href="#网卡软中断以及网卡远近的测试结论" class="headerlink" title="网卡软中断以及网卡远近的测试结论"></a>网卡软中断以及网卡远近的测试结论</h4><p>测试机器只是用了一块网卡，网卡插在node0上。</p>
<p>一般网卡中断会占用一些CPU，如果把网卡中断挪到其它node的core上，在鲲鹏920上测试，业务跑在node3（使用全部24core），网卡中断分别在node0和node3，QPS分别是：179000 VS 175000 （此时把中断放到node0或者是和node3最近的node2上差别不大）</p>
<p>如果将业务跑在node0上（全部24core），网卡中断分别在node0和node1上得到的QPS分别是：204000 VS 212000 </p>
<h3 id="tpcc-1000仓"><a href="#tpcc-1000仓" class="headerlink" title="tpcc 1000仓"></a>tpcc 1000仓</h3><p>测试结果(测试中Hygon 7280分别跑在CentOS7.9和麒麟上， 鲲鹏/intel CPU 跑在AliOS、麒麟是国产OS)：</p>
<p>tpcc测试数据，结果为1000仓，tpmC (NewOrders) ，未标注CPU 则为跑满了</p>
<table>
<thead>
<tr>
<th>测试核数</th>
<th>Intel 8269 2.50G</th>
<th>Intel 8163 2.50G</th>
<th>Hygon 7280 2.1GHz 麒麟</th>
<th>Hygon 7280 2.1G CentOS 7.9</th>
<th>鲲鹏 920-4826 2.6G</th>
<th>鲲鹏 920-4826 2.6G XDB8.0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1物理核</td>
<td>12392</td>
<td>9902</td>
<td>4706</td>
<td>7011</td>
<td>6619</td>
<td>4653</td>
</tr>
<tr>
<td>一对HT</td>
<td>17892</td>
<td>15324</td>
<td>8950</td>
<td>11778</td>
<td>无HT</td>
<td>无HT</td>
</tr>
<tr>
<td>4物理核</td>
<td>51525</td>
<td>40877</td>
<td>19387 380%</td>
<td>30046</td>
<td>23959</td>
<td>20101</td>
</tr>
<tr>
<td>8物理核</td>
<td>100792</td>
<td>81799</td>
<td>39664 750%</td>
<td>60086</td>
<td>42368</td>
<td>40572</td>
</tr>
<tr>
<td>16物理核</td>
<td>160798 抖动</td>
<td>140488 CPU抖动</td>
<td>75013 1400%</td>
<td>106419 1300-1550%</td>
<td>70581  1200%</td>
<td>79844</td>
</tr>
<tr>
<td>24物理核</td>
<td>188051</td>
<td>164757 1600-2100%</td>
<td>100841 1800-2000%</td>
<td>130815 1600-2100%</td>
<td>88204  1600%</td>
<td>115355</td>
</tr>
<tr>
<td>32物理核</td>
<td>195292</td>
<td>185171 2000-2500%</td>
<td>116071 1900-2400%</td>
<td>142746 1800-2400%</td>
<td>102089  1900%</td>
<td>143567</td>
</tr>
<tr>
<td>48物理核</td>
<td>19969l</td>
<td>195730 2100-2600%</td>
<td>128188  2100-2800%</td>
<td>149782 2000-2700%</td>
<td>116374  2500%</td>
<td>206055  4500%</td>
</tr>
</tbody>
</table>
<p>tpcc并发到一定程度后主要是锁导致性能上不去，所以超多核意义不大。</p>
<p>如果在Hygon 7280 2.1GHz 麒麟上起两个MySQLD实例，每个实例各绑定32物理core，性能刚好翻倍：<img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210823082702539.png" alt="image-20210823082702539"></p>
<p>测试过程CPU均跑满（未跑满的话会标注出来），IPC跑不起来性能就必然低，超线程虽然总性能好了但是会导致IPC降低(参考前面的公式)。可以看到对本来IPC比较低的场景，启用超线程后一般对性能会提升更大一些。</p>
<p>CPU核数增加到32核后，MySQL社区版性能追平xdb， 此时sysbench使用120线程压性能较好（AMD得240线程压）</p>
<p>32核的时候对比下MySQL 社区版在Hygon7280和Intel 8163下的表现：</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210817181752243.png" alt="image-20210817181752243"></p>
<h2 id="三款CPU的性能指标"><a href="#三款CPU的性能指标" class="headerlink" title="三款CPU的性能指标"></a>三款CPU的性能指标</h2><table>
<thead>
<tr>
<th style="text-align:left">测试项</th>
<th>AMD EPYC 7H12 2.5G</th>
<th style="text-align:left">Hygon 7280 2.1GHz</th>
<th style="text-align:left">Intel 8163 CPU @ 2.50GHz</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">内存带宽(MiB/s)</td>
<td>12190.50</td>
<td style="text-align:left">6206.06</td>
<td style="text-align:left">7474.45</td>
</tr>
<tr>
<td style="text-align:left">内存延时(遍历很大一个数组)</td>
<td>0.334ms</td>
<td style="text-align:left">0.336ms</td>
<td style="text-align:left">0.429ms</td>
</tr>
</tbody>
</table>
<h2 id="在lmbench上的测试数据"><a href="#在lmbench上的测试数据" class="headerlink" title="在lmbench上的测试数据"></a>在lmbench上的测试数据</h2><p>stream主要用于测试带宽，对应的时延是在带宽跑满情况下的带宽。</p>
<p>lat_mem_rd用来测试操作不同数据大小的时延。总的来说带宽看stream、时延看lat_mem_rd</p>
<h3 id="飞腾2500-1"><a href="#飞腾2500-1" class="headerlink" title="飞腾2500"></a>飞腾2500</h3><p>用stream测试带宽和latency，可以看到带宽随着numa距离不断减少、对应的latency不断增加，到最近的numa node有10%的损耗，这个损耗和numactl给出的距离完全一致。跨socket访问内存latency是node内的3倍，带宽是三分之一，但是socket1性能和socket0性能完全一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line">time for i in $(seq 7 8 128); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line"></div><div class="line">#numactl -C 7 -m 0 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 2.84 nanoseconds</div><div class="line">STREAM copy bandwidth: 5638.21 MB/sec</div><div class="line">STREAM scale latency: 2.72 nanoseconds</div><div class="line">STREAM scale bandwidth: 5885.97 MB/sec</div><div class="line">STREAM add latency: 2.26 nanoseconds</div><div class="line">STREAM add bandwidth: 10615.13 MB/sec</div><div class="line">STREAM triad latency: 4.53 nanoseconds</div><div class="line">STREAM triad bandwidth: 5297.93 MB/sec</div><div class="line"></div><div class="line">#numactl -C 7 -m 1 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.16 nanoseconds</div><div class="line">STREAM copy bandwidth: 5058.71 MB/sec</div><div class="line">STREAM scale latency: 3.15 nanoseconds</div><div class="line">STREAM scale bandwidth: 5074.78 MB/sec</div><div class="line">STREAM add latency: 2.35 nanoseconds</div><div class="line">STREAM add bandwidth: 10197.36 MB/sec</div><div class="line">STREAM triad latency: 5.12 nanoseconds</div><div class="line">STREAM triad bandwidth: 4686.37 MB/sec</div><div class="line"></div><div class="line">#numactl -C 7 -m 2 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.85 nanoseconds</div><div class="line">STREAM copy bandwidth: 4150.98 MB/sec</div><div class="line">STREAM scale latency: 3.95 nanoseconds</div><div class="line">STREAM scale bandwidth: 4054.30 MB/sec</div><div class="line">STREAM add latency: 2.64 nanoseconds</div><div class="line">STREAM add bandwidth: 9100.12 MB/sec</div><div class="line">STREAM triad latency: 6.39 nanoseconds</div><div class="line">STREAM triad bandwidth: 3757.70 MB/sec</div><div class="line"></div><div class="line">#numactl -C 7 -m 3 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.69 nanoseconds</div><div class="line">STREAM copy bandwidth: 4340.24 MB/sec</div><div class="line">STREAM scale latency: 3.62 nanoseconds</div><div class="line">STREAM scale bandwidth: 4422.18 MB/sec</div><div class="line">STREAM add latency: 2.47 nanoseconds</div><div class="line">STREAM add bandwidth: 9704.82 MB/sec</div><div class="line">STREAM triad latency: 5.74 nanoseconds</div><div class="line">STREAM triad bandwidth: 4177.85 MB/sec</div><div class="line"></div><div class="line">[root@101a05001.cloud.a05.am11 /root/lmbench3]</div><div class="line">#numactl -C 7 -m 7 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.95 nanoseconds</div><div class="line">STREAM copy bandwidth: 4051.51 MB/sec</div><div class="line">STREAM scale latency: 3.94 nanoseconds</div><div class="line">STREAM scale bandwidth: 4060.63 MB/sec</div><div class="line">STREAM add latency: 2.54 nanoseconds</div><div class="line">STREAM add bandwidth: 9434.51 MB/sec</div><div class="line">STREAM triad latency: 6.13 nanoseconds</div><div class="line">STREAM triad bandwidth: 3913.36 MB/sec</div><div class="line"></div><div class="line">[root@101a05001.cloud.a05.am11 /root/lmbench3]</div><div class="line">#numactl -C 7 -m 10 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 8.80 nanoseconds</div><div class="line">STREAM copy bandwidth: 1817.78 MB/sec</div><div class="line">STREAM scale latency: 8.59 nanoseconds</div><div class="line">STREAM scale bandwidth: 1861.65 MB/sec</div><div class="line">STREAM add latency: 5.55 nanoseconds</div><div class="line">STREAM add bandwidth: 4320.68 MB/sec</div><div class="line">STREAM triad latency: 13.94 nanoseconds</div><div class="line">STREAM triad bandwidth: 1721.76 MB/sec</div><div class="line"></div><div class="line">[root@101a05001.cloud.a05.am11 /root/lmbench3]</div><div class="line">#numactl -C 7 -m 11 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 9.27 nanoseconds</div><div class="line">STREAM copy bandwidth: 1726.52 MB/sec</div><div class="line">STREAM scale latency: 9.31 nanoseconds</div><div class="line">STREAM scale bandwidth: 1718.10 MB/sec</div><div class="line">STREAM add latency: 5.65 nanoseconds</div><div class="line">STREAM add bandwidth: 4250.89 MB/sec</div><div class="line">STREAM triad latency: 14.09 nanoseconds</div><div class="line">STREAM triad bandwidth: 1703.66 MB/sec</div><div class="line"></div><div class="line">[root@101a05001.cloud.a05.am11 /root/lmbench3]</div><div class="line">#numactl -C 88 -m 11 ./bin/stream  -W 5 -N 5 -M 64M //在另外一个socket上测试本numa，和node0性能完全一致</div><div class="line">STREAM copy latency: 2.93 nanoseconds</div><div class="line">STREAM copy bandwidth: 5454.67 MB/sec</div><div class="line">STREAM scale latency: 2.96 nanoseconds</div><div class="line">STREAM scale bandwidth: 5400.03 MB/sec</div><div class="line">STREAM add latency: 2.28 nanoseconds</div><div class="line">STREAM add bandwidth: 10543.42 MB/sec</div><div class="line">STREAM triad latency: 4.52 nanoseconds</div><div class="line">STREAM triad bandwidth: 5308.40 MB/sec</div><div class="line"></div><div class="line">[root@101a05001.cloud.a05.am11 /root/lmbench3]</div><div class="line">#numactl -C 7 -m 15 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 8.73 nanoseconds</div><div class="line">STREAM copy bandwidth: 1831.77 MB/sec</div><div class="line">STREAM scale latency: 8.81 nanoseconds</div><div class="line">STREAM scale bandwidth: 1815.13 MB/sec</div><div class="line">STREAM add latency: 5.63 nanoseconds</div><div class="line">STREAM add bandwidth: 4265.21 MB/sec</div><div class="line">STREAM triad latency: 13.09 nanoseconds</div><div class="line">STREAM triad bandwidth: 1833.68 MB/sec</div></pre></td></tr></table></figure>
<p>Lat_mem_rd 用cpu7访问node0和node15对比结果，随着数据的加大，延时在加大，64M时能有3倍差距，和上面测试一致</p>
<p>下图 第一列 表示读写数据的大小（单位M），第二列表示访问延时（单位纳秒），一般可以看到在L1/L2/L3 cache大小的地方延时会有跳跃，远超过L3大小后，延时就是内存延时了</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20210924185044090.png" alt="image-20210924185044090"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">numactl -C 7 -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 64M  //-C 7 cpu 7, -m 0 node0, -W 热身 -t stride</div></pre></td></tr></table></figure>
<p>同样的机型，开关numa的测试结果，关numa 时延、带宽都差了几倍</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220323153507557.png" alt="image-20220323153507557"></p>
<p>关闭numa的机器上测试结果随机性很强，这应该是和内存分配在那里有关系，不过如果机器一直保持这个状态反复测试的话，快的core一直快，慢的core一直慢，这是因为物理地址分配有一定的规律，在物理内存没怎么变化的情况下，快的core恰好分到的内存比较近。</p>
<p>同时不同机器状态（内存使用率）测试结果也不一样</p>
<h3 id="鲲鹏920-1"><a href="#鲲鹏920-1" class="headerlink" title="鲲鹏920"></a>鲲鹏920</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#for i in $(seq 0 15); do echo core:$i; numactl -N $i -m 7 ./bin/stream  -W 5 -N 5 -M 64M; done</div><div class="line">STREAM copy latency: 1.84 nanoseconds</div><div class="line">STREAM copy bandwidth: 8700.75 MB/sec</div><div class="line">STREAM scale latency: 1.86 nanoseconds</div><div class="line">STREAM scale bandwidth: 8623.60 MB/sec</div><div class="line">STREAM add latency: 2.18 nanoseconds</div><div class="line">STREAM add bandwidth: 10987.04 MB/sec</div><div class="line">STREAM triad latency: 3.03 nanoseconds</div><div class="line">STREAM triad bandwidth: 7926.87 MB/sec</div><div class="line"></div><div class="line">#numactl -C 7 -m 1 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 2.05 nanoseconds</div><div class="line">STREAM copy bandwidth: 7802.45 MB/sec</div><div class="line">STREAM scale latency: 2.08 nanoseconds</div><div class="line">STREAM scale bandwidth: 7681.87 MB/sec</div><div class="line">STREAM add latency: 2.19 nanoseconds</div><div class="line">STREAM add bandwidth: 10954.76 MB/sec</div><div class="line">STREAM triad latency: 3.17 nanoseconds</div><div class="line">STREAM triad bandwidth: 7559.86 MB/sec</div><div class="line"></div><div class="line">#numactl -C 7 -m 2 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.51 nanoseconds</div><div class="line">STREAM copy bandwidth: 4556.86 MB/sec</div><div class="line">STREAM scale latency: 3.58 nanoseconds</div><div class="line">STREAM scale bandwidth: 4463.66 MB/sec</div><div class="line">STREAM add latency: 2.71 nanoseconds</div><div class="line">STREAM add bandwidth: 8869.79 MB/sec</div><div class="line">STREAM triad latency: 5.92 nanoseconds</div><div class="line">STREAM triad bandwidth: 4057.12 MB/sec</div><div class="line"></div><div class="line">[root@ARM 19:14 /root/lmbench3]</div><div class="line">#numactl -C 7 -m 3 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 3.94 nanoseconds</div><div class="line">STREAM copy bandwidth: 4064.25 MB/sec</div><div class="line">STREAM scale latency: 3.82 nanoseconds</div><div class="line">STREAM scale bandwidth: 4188.67 MB/sec</div><div class="line">STREAM add latency: 2.86 nanoseconds</div><div class="line">STREAM add bandwidth: 8390.70 MB/sec</div><div class="line">STREAM triad latency: 4.78 nanoseconds</div><div class="line">STREAM triad bandwidth: 5024.25 MB/sec</div><div class="line"></div><div class="line">#numactl -C 24 -m 3 ./bin/stream  -W 5 -N 5 -M 64M</div><div class="line">STREAM copy latency: 4.10 nanoseconds</div><div class="line">STREAM copy bandwidth: 3904.63 MB/sec</div><div class="line">STREAM scale latency: 4.03 nanoseconds</div><div class="line">STREAM scale bandwidth: 3969.41 MB/sec</div><div class="line">STREAM add latency: 3.07 nanoseconds</div><div class="line">STREAM add bandwidth: 7816.08 MB/sec</div><div class="line">STREAM triad latency: 5.06 nanoseconds</div><div class="line">STREAM triad bandwidth: 4738.66 MB/sec</div></pre></td></tr></table></figure>
<h3 id="海光7280"><a href="#海光7280" class="headerlink" title="海光7280"></a>海光7280</h3><p>可以看到跨numa（一个numa也就是一个socket，等同于跨socket）RT从1.5上升到2.5，这个数据比鲲鹏920要好很多</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">[root@hygon8 14:32 /root/lmbench-master]</div><div class="line">#lscpu</div><div class="line">架构：                           x86_64</div><div class="line">CPU 运行模式：                   32-bit, 64-bit</div><div class="line">字节序：                         Little Endian</div><div class="line">Address sizes:                   43 bits physical, 48 bits virtual</div><div class="line">CPU:                             128</div><div class="line">在线 CPU 列表：                  0-127</div><div class="line">每个核的线程数：                 2</div><div class="line">每个座的核数：                   32</div><div class="line">座：                             2</div><div class="line">NUMA 节点：                      8</div><div class="line">厂商 ID：                        HygonGenuine</div><div class="line">CPU 系列：                       24</div><div class="line">型号：                           1</div><div class="line">型号名称：                       Hygon C86 7280 32-core Processor</div><div class="line">步进：                           1</div><div class="line">CPU MHz：                        2194.586</div><div class="line">BogoMIPS：                       3999.63</div><div class="line">虚拟化：                         AMD-V</div><div class="line">L1d 缓存：                       2 MiB</div><div class="line">L1i 缓存：                       4 MiB</div><div class="line">L2 缓存：                        32 MiB</div><div class="line">L3 缓存：                        128 MiB</div><div class="line">NUMA 节点0 CPU：                 0-7,64-71</div><div class="line">NUMA 节点1 CPU：                 8-15,72-79</div><div class="line">NUMA 节点2 CPU：                 16-23,80-87</div><div class="line">NUMA 节点3 CPU：                 24-31,88-95</div><div class="line">NUMA 节点4 CPU：                 32-39,96-103</div><div class="line">NUMA 节点5 CPU：                 40-47,104-111</div><div class="line">NUMA 节点6 CPU：                 48-55,112-119</div><div class="line">NUMA 节点7 CPU：                 56-63,120-127</div><div class="line"></div><div class="line">//可以看到7号core比15、23、31号core明显要快，就近访问node 0的内存，跨numa node（跨Die）没有内存交织分配</div><div class="line">[root@hygon8 14:32 /root/lmbench-master]</div><div class="line">#time for i in $(seq 7 8 64); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line">7</div><div class="line">STREAM copy latency: 1.38 nanoseconds    </div><div class="line">STREAM copy bandwidth: 11559.53 MB/sec</div><div class="line">STREAM scale latency: 1.16 nanoseconds</div><div class="line">STREAM scale bandwidth: 13815.87 MB/sec</div><div class="line">STREAM add latency: 1.40 nanoseconds</div><div class="line">STREAM add bandwidth: 17145.85 MB/sec</div><div class="line">STREAM triad latency: 1.44 nanoseconds</div><div class="line">STREAM triad bandwidth: 16637.18 MB/sec</div><div class="line">15</div><div class="line">STREAM copy latency: 1.67 nanoseconds</div><div class="line">STREAM copy bandwidth: 9591.77 MB/sec</div><div class="line">STREAM scale latency: 1.56 nanoseconds</div><div class="line">STREAM scale bandwidth: 10242.50 MB/sec</div><div class="line">STREAM add latency: 1.45 nanoseconds</div><div class="line">STREAM add bandwidth: 16581.00 MB/sec</div><div class="line">STREAM triad latency: 2.00 nanoseconds</div><div class="line">STREAM triad bandwidth: 12028.83 MB/sec</div><div class="line">23</div><div class="line">STREAM copy latency: 1.65 nanoseconds</div><div class="line">STREAM copy bandwidth: 9701.49 MB/sec</div><div class="line">STREAM scale latency: 1.53 nanoseconds</div><div class="line">STREAM scale bandwidth: 10427.98 MB/sec</div><div class="line">STREAM add latency: 1.42 nanoseconds</div><div class="line">STREAM add bandwidth: 16846.10 MB/sec</div><div class="line">STREAM triad latency: 1.97 nanoseconds</div><div class="line">STREAM triad bandwidth: 12189.72 MB/sec</div><div class="line">31</div><div class="line">STREAM copy latency: 1.64 nanoseconds</div><div class="line">STREAM copy bandwidth: 9742.86 MB/sec</div><div class="line">STREAM scale latency: 1.52 nanoseconds</div><div class="line">STREAM scale bandwidth: 10510.80 MB/sec</div><div class="line">STREAM add latency: 1.45 nanoseconds</div><div class="line">STREAM add bandwidth: 16559.86 MB/sec</div><div class="line">STREAM triad latency: 1.92 nanoseconds</div><div class="line">STREAM triad bandwidth: 12490.01 MB/sec</div><div class="line">39</div><div class="line">STREAM copy latency: 2.55 nanoseconds</div><div class="line">STREAM copy bandwidth: 6286.25 MB/sec</div><div class="line">STREAM scale latency: 2.51 nanoseconds</div><div class="line">STREAM scale bandwidth: 6383.11 MB/sec</div><div class="line">STREAM add latency: 1.76 nanoseconds</div><div class="line">STREAM add bandwidth: 13660.83 MB/sec</div><div class="line">STREAM triad latency: 3.68 nanoseconds</div><div class="line">STREAM triad bandwidth: 6523.02 MB/sec</div></pre></td></tr></table></figure>
<p>如果这种芯片在bios里设置Die interleaving，4块die当成一个numa node吐出来给OS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">#lscpu</div><div class="line">架构：                           x86_64</div><div class="line">CPU 运行模式：                   32-bit, 64-bit</div><div class="line">字节序：                         Little Endian</div><div class="line">Address sizes:                   43 bits physical, 48 bits virtual</div><div class="line">CPU:                             128</div><div class="line">在线 CPU 列表：                  0-127</div><div class="line">每个核的线程数：                 2</div><div class="line">每个座的核数：                   32</div><div class="line">座：                             2</div><div class="line">NUMA 节点：                      2</div><div class="line">厂商 ID：                        HygonGenuine</div><div class="line">CPU 系列：                       24</div><div class="line">型号：                           1</div><div class="line">型号名称：                       Hygon C86 7280 32-core Processor</div><div class="line">步进：                           1</div><div class="line">CPU MHz：                        2108.234</div><div class="line">BogoMIPS：                       3999.45</div><div class="line">虚拟化：                         AMD-V</div><div class="line">L1d 缓存：                       2 MiB</div><div class="line">L1i 缓存：                       4 MiB</div><div class="line">L2 缓存：                        32 MiB</div><div class="line">L3 缓存：                        128 MiB</div><div class="line">//注意这里和真实物理架构不一致，bios配置了Die Interleaving Enable</div><div class="line">//表示每路内多个Die内存交织分配，这样整个一路就是一个大Die</div><div class="line">NUMA 节点0 CPU：                 0-31,64-95  </div><div class="line">NUMA 节点1 CPU：                 32-63,96-127</div><div class="line"></div><div class="line"></div><div class="line">//enable die interleaving 后继续streaming测试</div><div class="line">//最终测试结果表现就是7/15/23/31 core性能一致，因为默认一个numa内内存交织分配</div><div class="line">//可以看到同一路下的四个die内存交织访问，所以4个node内存延时一样了（被平均），都不如就近快</div><div class="line">[root@hygon3 16:09 /root/lmbench-master]</div><div class="line">#time for i in $(seq 7 8 64); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line">7</div><div class="line">STREAM copy latency: 1.48 nanoseconds</div><div class="line">STREAM copy bandwidth: 10782.58 MB/sec</div><div class="line">STREAM scale latency: 1.20 nanoseconds</div><div class="line">STREAM scale bandwidth: 13364.38 MB/sec</div><div class="line">STREAM add latency: 1.46 nanoseconds</div><div class="line">STREAM add bandwidth: 16408.32 MB/sec</div><div class="line">STREAM triad latency: 1.53 nanoseconds</div><div class="line">STREAM triad bandwidth: 15696.00 MB/sec</div><div class="line">15</div><div class="line">STREAM copy latency: 1.51 nanoseconds</div><div class="line">STREAM copy bandwidth: 10601.25 MB/sec</div><div class="line">STREAM scale latency: 1.24 nanoseconds</div><div class="line">STREAM scale bandwidth: 12855.87 MB/sec</div><div class="line">STREAM add latency: 1.46 nanoseconds</div><div class="line">STREAM add bandwidth: 16382.42 MB/sec</div><div class="line">STREAM triad latency: 1.53 nanoseconds</div><div class="line">STREAM triad bandwidth: 15691.48 MB/sec</div><div class="line">23</div><div class="line">STREAM copy latency: 1.50 nanoseconds</div><div class="line">STREAM copy bandwidth: 10700.61 MB/sec</div><div class="line">STREAM scale latency: 1.27 nanoseconds</div><div class="line">STREAM scale bandwidth: 12634.63 MB/sec</div><div class="line">STREAM add latency: 1.47 nanoseconds</div><div class="line">STREAM add bandwidth: 16370.67 MB/sec</div><div class="line">STREAM triad latency: 1.55 nanoseconds</div><div class="line">STREAM triad bandwidth: 15455.75 MB/sec</div><div class="line">31</div><div class="line">STREAM copy latency: 1.50 nanoseconds</div><div class="line">STREAM copy bandwidth: 10637.39 MB/sec</div><div class="line">STREAM scale latency: 1.25 nanoseconds</div><div class="line">STREAM scale bandwidth: 12778.99 MB/sec</div><div class="line">STREAM add latency: 1.46 nanoseconds</div><div class="line">STREAM add bandwidth: 16420.65 MB/sec</div><div class="line">STREAM triad latency: 1.61 nanoseconds</div><div class="line">STREAM triad bandwidth: 14946.80 MB/sec</div><div class="line">39</div><div class="line">STREAM copy latency: 2.35 nanoseconds</div><div class="line">STREAM copy bandwidth: 6807.09 MB/sec</div><div class="line">STREAM scale latency: 2.32 nanoseconds</div><div class="line">STREAM scale bandwidth: 6906.93 MB/sec</div><div class="line">STREAM add latency: 1.63 nanoseconds</div><div class="line">STREAM add bandwidth: 14729.23 MB/sec</div><div class="line">STREAM triad latency: 3.36 nanoseconds</div><div class="line">STREAM triad bandwidth: 7151.67 MB/sec</div><div class="line">47</div><div class="line">STREAM copy latency: 2.31 nanoseconds</div><div class="line">STREAM copy bandwidth: 6938.47 MB/sec</div></pre></td></tr></table></figure>
<p><a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100088653/32aa8773" target="_blank" rel="external">以华为泰山服务器(鲲鹏920芯片)配置为例</a>：<img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20211228165542167.png" alt="image-20211228165542167"></p>
<blockquote>
<p>Die Interleaving 控制是否使能DIE交织。使能DIE交织能充分利用系统的DDR带宽，并尽量保证各DDR通道的带宽均衡，提升DDR的利用率</p>
</blockquote>
<h3 id="hygon5280测试数据"><a href="#hygon5280测试数据" class="headerlink" title="hygon5280测试数据"></a>hygon5280测试数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">-----hygon5280测试数据</div><div class="line">[root@localhost lmbench-master]# for i in $(seq 0 8 24); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line">0</div><div class="line">STREAM copy latency: 1.22 nanoseconds</div><div class="line">STREAM copy bandwidth: 13166.34 MB/sec</div><div class="line">STREAM scale latency: 1.13 nanoseconds</div><div class="line">STREAM scale bandwidth: 14166.95 MB/sec</div><div class="line">STREAM add latency: 1.15 nanoseconds</div><div class="line">STREAM add bandwidth: 20818.63 MB/sec</div><div class="line">STREAM triad latency: 1.39 nanoseconds</div><div class="line">STREAM triad bandwidth: 17211.81 MB/sec</div><div class="line">8</div><div class="line">STREAM copy latency: 1.56 nanoseconds</div><div class="line">STREAM copy bandwidth: 10273.07 MB/sec</div><div class="line">STREAM scale latency: 1.50 nanoseconds</div><div class="line">STREAM scale bandwidth: 10701.89 MB/sec</div><div class="line">STREAM add latency: 1.20 nanoseconds</div><div class="line">STREAM add bandwidth: 19996.68 MB/sec</div><div class="line">STREAM triad latency: 1.93 nanoseconds</div><div class="line">STREAM triad bandwidth: 12443.70 MB/sec</div><div class="line">16</div><div class="line">STREAM copy latency: 2.52 nanoseconds</div><div class="line">STREAM copy bandwidth: 6357.71 MB/sec</div><div class="line">STREAM scale latency: 2.48 nanoseconds</div><div class="line">STREAM scale bandwidth: 6454.95 MB/sec</div><div class="line">STREAM add latency: 1.67 nanoseconds</div><div class="line">STREAM add bandwidth: 14362.51 MB/sec</div><div class="line">STREAM triad latency: 3.65 nanoseconds</div><div class="line">STREAM triad bandwidth: 6572.85 MB/sec</div><div class="line">24</div><div class="line">STREAM copy latency: 2.44 nanoseconds</div><div class="line">STREAM copy bandwidth: 6554.24 MB/sec</div><div class="line">STREAM scale latency: 2.41 nanoseconds</div><div class="line">STREAM scale bandwidth: 6642.80 MB/sec</div><div class="line">STREAM add latency: 1.44 nanoseconds</div><div class="line">STREAM add bandwidth: 16695.82 MB/sec</div><div class="line">STREAM triad latency: 3.61 nanoseconds</div><div class="line">STREAM triad bandwidth: 6639.18 MB/sec</div><div class="line">[root@localhost lmbench-master]# lscpu</div><div class="line">架构：                           x86_64</div><div class="line">CPU 运行模式：                   32-bit, 64-bit</div><div class="line">字节序：                         Little Endian</div><div class="line">Address sizes:                   43 bits physical, 48 bits virtual</div><div class="line">CPU:                             64</div><div class="line">在线 CPU 列表：                  0-63</div><div class="line">每个核的线程数：                 2</div><div class="line">每个座的核数：                   16</div><div class="line">座：                             2</div><div class="line">NUMA 节点：                      4</div><div class="line">厂商 ID：                        HygonGenuine</div><div class="line">CPU 系列：                       24</div><div class="line">型号：                           1</div><div class="line">型号名称：                       Hygon C86 5280 16-core Processor</div><div class="line">步进：                           1</div><div class="line">Frequency boost:                 enabled</div><div class="line">CPU MHz：                        2799.311</div><div class="line">CPU 最大 MHz：                   2500.0000</div><div class="line">CPU 最小 MHz：                   1600.0000</div><div class="line">BogoMIPS：                       4999.36</div><div class="line">虚拟化：                         AMD-V</div><div class="line">L1d 缓存：                       1 MiB</div><div class="line">L1i 缓存：                       2 MiB</div><div class="line">L2 缓存：                        16 MiB</div><div class="line">L3 缓存：                        64 MiB</div><div class="line">NUMA 节点0 CPU：                 0-7,32-39</div><div class="line">NUMA 节点1 CPU：                 8-15,40-47</div><div class="line">NUMA 节点2 CPU：                 16-23,48-55</div><div class="line">NUMA 节点3 CPU：                 24-31,56-63</div><div class="line">Vulnerability Itlb multihit:     Not affected</div><div class="line">Vulnerability L1tf:              Not affected</div><div class="line">Vulnerability Mds:               Not affected</div><div class="line">Vulnerability Meltdown:          Not affected</div><div class="line">Vulnerability Spec store bypass: Mitigation; Speculative Store Bypass disabled via prctl and seccomp</div><div class="line">Vulnerability Spectre v1:        Mitigation; usercopy/swapgs barriers and __user pointer sanitization</div><div class="line">Vulnerability Spectre v2:        Mitigation; Full AMD retpoline, IBPB conditional, STIBP disabled, RSB</div><div class="line">                                 filling</div><div class="line">Vulnerability Srbds:             Not affected</div><div class="line">Vulnerability Tsx async abort:   Not affected</div><div class="line">标记：                           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse3</div><div class="line">                                 6 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdts</div><div class="line">                                 cp lm constant_tsc rep_good nopl nonstop_tsc cpuid extd_apicid amd_dcm</div><div class="line">                                  aperfmperf pni pclmulqdq monitor ssse3 fma cx16 sse4_1 sse4_2 movbe p</div><div class="line">                                 opcnt xsave avx f16c rdrand lahf_lm cmp_legacy svm extapic cr8_legacy</div><div class="line">                                 abm sse4a misalignsse 3dnowprefetch osvw skinit wdt tce topoext perfct</div><div class="line">                                 r_core perfctr_nb bpext perfctr_llc mwaitx cpb hw_pstate sme ssbd sev</div><div class="line">                                 ibpb vmmcall fsgsbase bmi1 avx2 smep bmi2 rdseed adx smap clflushopt s</div><div class="line">                                 ha_ni xsaveopt xsavec xgetbv1 xsaves clzero irperf xsaveerptr arat npt</div><div class="line">                                  lbrv svm_lock nrip_save tsc_scale vmcb_clean flushbyasid decodeassist</div><div class="line">                                 s pausefilter pfthreshold avic v_vmsave_vmload vgif overflow_recov suc</div><div class="line">                                 cor smca</div></pre></td></tr></table></figure>
<h3 id="intel-8269CY"><a href="#intel-8269CY" class="headerlink" title="intel 8269CY"></a>intel 8269CY</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">lscpu</div><div class="line">Architecture:          x86_64</div><div class="line">CPU op-mode(s):        32-bit, 64-bit</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                104</div><div class="line">On-line CPU(s) list:   0-103</div><div class="line">Thread(s) per core:    2</div><div class="line">Core(s) per socket:    26</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          2</div><div class="line">Vendor ID:             GenuineIntel</div><div class="line">CPU family:            6</div><div class="line">Model:                 85</div><div class="line">Model name:            Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz</div><div class="line">Stepping:              7</div><div class="line">CPU MHz:               3200.000</div><div class="line">CPU max MHz:           3800.0000</div><div class="line">CPU min MHz:           1200.0000</div><div class="line">BogoMIPS:              4998.89</div><div class="line">Virtualization:        VT-x</div><div class="line">L1d cache:             32K</div><div class="line">L1i cache:             32K</div><div class="line">L2 cache:              1024K</div><div class="line">L3 cache:              36608K</div><div class="line">NUMA node0 CPU(s):     0-25,52-77</div><div class="line">NUMA node1 CPU(s):     26-51,78-103</div><div class="line"></div><div class="line">[root@numaopen.cloud.et93 /home/ren/lmbench3]</div><div class="line">#time for i in $(seq 0 8 51); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line">0</div><div class="line">STREAM copy latency: 1.15 nanoseconds</div><div class="line">STREAM copy bandwidth: 13941.80 MB/sec</div><div class="line">STREAM scale latency: 1.16 nanoseconds</div><div class="line">STREAM scale bandwidth: 13799.89 MB/sec</div><div class="line">STREAM add latency: 1.31 nanoseconds</div><div class="line">STREAM add bandwidth: 18318.23 MB/sec</div><div class="line">STREAM triad latency: 1.56 nanoseconds</div><div class="line">STREAM triad bandwidth: 15356.72 MB/sec</div><div class="line">16</div><div class="line">STREAM copy latency: 1.12 nanoseconds</div><div class="line">STREAM copy bandwidth: 14293.68 MB/sec</div><div class="line">STREAM scale latency: 1.13 nanoseconds</div><div class="line">STREAM scale bandwidth: 14162.47 MB/sec</div><div class="line">STREAM add latency: 1.31 nanoseconds</div><div class="line">STREAM add bandwidth: 18293.27 MB/sec</div><div class="line">STREAM triad latency: 1.53 nanoseconds</div><div class="line">STREAM triad bandwidth: 15692.47 MB/sec</div><div class="line">32</div><div class="line">STREAM copy latency: 1.52 nanoseconds</div><div class="line">STREAM copy bandwidth: 10551.71 MB/sec</div><div class="line">STREAM scale latency: 1.52 nanoseconds</div><div class="line">STREAM scale bandwidth: 10508.33 MB/sec</div><div class="line">STREAM add latency: 1.38 nanoseconds</div><div class="line">STREAM add bandwidth: 17363.22 MB/sec</div><div class="line">STREAM triad latency: 2.00 nanoseconds</div><div class="line">STREAM triad bandwidth: 12024.52 MB/sec</div><div class="line">40</div><div class="line">STREAM copy latency: 1.49 nanoseconds</div><div class="line">STREAM copy bandwidth: 10758.50 MB/sec</div><div class="line">STREAM scale latency: 1.50 nanoseconds</div><div class="line">STREAM scale bandwidth: 10680.17 MB/sec</div><div class="line">STREAM add latency: 1.34 nanoseconds</div><div class="line">STREAM add bandwidth: 17948.34 MB/sec</div><div class="line">STREAM triad latency: 1.98 nanoseconds</div><div class="line">STREAM triad bandwidth: 12133.22 MB/sec</div><div class="line">48</div><div class="line">STREAM copy latency: 1.49 nanoseconds</div><div class="line">STREAM copy bandwidth: 10736.56 MB/sec</div><div class="line">STREAM scale latency: 1.50 nanoseconds</div><div class="line">STREAM scale bandwidth: 10692.93 MB/sec</div><div class="line">STREAM add latency: 1.34 nanoseconds</div><div class="line">STREAM add bandwidth: 17902.85 MB/sec</div><div class="line">STREAM triad latency: 1.96 nanoseconds</div><div class="line">STREAM triad bandwidth: 12239.44 MB/sec</div></pre></td></tr></table></figure>
<h3 id="Intel-R-Xeon-R-CPU-E5-2682-v4"><a href="#Intel-R-Xeon-R-CPU-E5-2682-v4" class="headerlink" title="Intel(R) Xeon(R) CPU E5-2682 v4"></a>Intel(R) Xeon(R) CPU E5-2682 v4</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">#time for i in $(seq 0 8 51); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done</div><div class="line">0</div><div class="line">STREAM copy latency: 1.59 nanoseconds</div><div class="line">STREAM copy bandwidth: 10092.31 MB/sec</div><div class="line">STREAM scale latency: 1.57 nanoseconds</div><div class="line">STREAM scale bandwidth: 10169.16 MB/sec</div><div class="line">STREAM add latency: 1.31 nanoseconds</div><div class="line">STREAM add bandwidth: 18360.83 MB/sec</div><div class="line">STREAM triad latency: 2.28 nanoseconds</div><div class="line">STREAM triad bandwidth: 10503.81 MB/sec</div><div class="line">8</div><div class="line">STREAM copy latency: 1.55 nanoseconds</div><div class="line">STREAM copy bandwidth: 10312.14 MB/sec</div><div class="line">STREAM scale latency: 1.56 nanoseconds</div><div class="line">STREAM scale bandwidth: 10283.70 MB/sec</div><div class="line">STREAM add latency: 1.30 nanoseconds</div><div class="line">STREAM add bandwidth: 18416.26 MB/sec</div><div class="line">STREAM triad latency: 2.23 nanoseconds</div><div class="line">STREAM triad bandwidth: 10777.08 MB/sec</div><div class="line">16</div><div class="line">STREAM copy latency: 2.02 nanoseconds</div><div class="line">STREAM copy bandwidth: 7914.25 MB/sec</div><div class="line">STREAM scale latency: 2.02 nanoseconds</div><div class="line">STREAM scale bandwidth: 7919.85 MB/sec</div><div class="line">STREAM add latency: 1.39 nanoseconds</div><div class="line">STREAM add bandwidth: 17276.06 MB/sec</div><div class="line">STREAM triad latency: 2.92 nanoseconds</div><div class="line">STREAM triad bandwidth: 8231.18 MB/sec</div><div class="line">24</div><div class="line">STREAM copy latency: 1.99 nanoseconds</div><div class="line">STREAM copy bandwidth: 8032.18 MB/sec</div><div class="line">STREAM scale latency: 1.98 nanoseconds</div><div class="line">STREAM scale bandwidth: 8061.12 MB/sec</div><div class="line">STREAM add latency: 1.39 nanoseconds</div><div class="line">STREAM add bandwidth: 17313.94 MB/sec</div><div class="line">STREAM triad latency: 2.88 nanoseconds</div><div class="line">STREAM triad bandwidth: 8318.93 MB/sec</div><div class="line"></div><div class="line">#lscpu</div><div class="line">Architecture:          x86_64</div><div class="line">CPU op-mode(s):        32-bit, 64-bit</div><div class="line">Byte Order:            Little Endian</div><div class="line">CPU(s):                64</div><div class="line">On-line CPU(s) list:   0-63</div><div class="line">Thread(s) per core:    2</div><div class="line">Core(s) per socket:    16</div><div class="line">Socket(s):             2</div><div class="line">NUMA node(s):          2</div><div class="line">Vendor ID:             GenuineIntel</div><div class="line">CPU family:            6</div><div class="line">Model:                 79</div><div class="line">Model name:            Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz</div><div class="line">Stepping:              1</div><div class="line">CPU MHz:               2500.000</div><div class="line">CPU max MHz:           3000.0000</div><div class="line">CPU min MHz:           1200.0000</div><div class="line">BogoMIPS:              5000.06</div><div class="line">Virtualization:        VT-x</div><div class="line">L1d cache:             32K</div><div class="line">L1i cache:             32K</div><div class="line">L2 cache:              256K</div><div class="line">L3 cache:              40960K</div><div class="line">NUMA node0 CPU(s):     0-15,32-47</div><div class="line">NUMA node1 CPU(s):     16-31,48-63</div></pre></td></tr></table></figure>
<h3 id="stream对比数据"><a href="#stream对比数据" class="headerlink" title="stream对比数据"></a>stream对比数据</h3><p>总结下几个CPU用stream测试访问内存的RT以及抖动和带宽对比数据</p>
<table>
<thead>
<tr>
<th></th>
<th>最小RT</th>
<th>最大RT</th>
<th>最大copy bandwidth</th>
<th>最小copy bandwidth</th>
</tr>
</thead>
<tbody>
<tr>
<td>申威3231(2numa node)</td>
<td>7.09</td>
<td>8.75</td>
<td>2256.59 MB/sec</td>
<td>1827.88 MB/sec</td>
</tr>
<tr>
<td>飞腾2500(16 numa node)</td>
<td>2.84</td>
<td>10.34</td>
<td>5638.21 MB/sec</td>
<td>1546.68 MB/sec</td>
</tr>
<tr>
<td>鲲鹏920(4 numa node)</td>
<td>1.84</td>
<td>3.87</td>
<td>8700.75 MB/sec</td>
<td>4131.81 MB/sec</td>
</tr>
<tr>
<td>海光7280(8 numa node)</td>
<td>1.38</td>
<td>2.58</td>
<td>11591.48 MB/sec</td>
<td>6206.99 MB/sec</td>
</tr>
<tr>
<td>海光5280(4 numa node)</td>
<td>1.22</td>
<td>2.52</td>
<td>13166.34 MB/sec</td>
<td>6357.71 MB/sec</td>
</tr>
<tr>
<td>Intel8269CY(2 numa node)</td>
<td>1.12</td>
<td>1.52</td>
<td>14293.68 MB/sec</td>
<td>10551.71 MB/sec</td>
</tr>
<tr>
<td>Intel E5-2682(2 numa node)</td>
<td>1.58</td>
<td>2.02</td>
<td>10092.31 MB/sec</td>
<td>7914.25 MB/sec</td>
</tr>
<tr>
<td>倚天710</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>从以上数据可以看出这5款CPU性能一款比一款好，飞腾2500慢的core上延时快到intel 8269的10倍了，平均延时5倍以上了。延时数据基本和单核上测试sysbench TPS一致。性能差不多就是：常数*主频/RT</p>
<h3 id="lat-mem-rd对比数据"><a href="#lat-mem-rd对比数据" class="headerlink" title="lat_mem_rd对比数据"></a>lat_mem_rd对比数据</h3><p>用不同的node上的core 跑lat_mem_rd测试访问node0内存的RT，只取最大64M的时延，时延和node距离完全一致</p>
<table>
<thead>
<tr>
<th></th>
<th>RT变化</th>
</tr>
</thead>
<tbody>
<tr>
<td>飞腾2500(16 numa node)</td>
<td>core:0      149.976<br>core:8      168.805<br>core:16     191.415<br>core:24     178.283<br>core:32     170.814<br>core:40     185.699<br>core:48     212.281<br>core:56     202.479<br>core:64     426.176<br>core:72     444.367<br>core:80     465.894<br>core:88     452.245<br>core:96     448.352<br>core:104   460.603<br>core:112   485.989<br>core:120    490.402</td>
</tr>
<tr>
<td>鲲鹏920(4 numa node)</td>
<td>core:0 117.323<br>core:24 135.337<br>core:48 197.782<br>core:72 219.416</td>
</tr>
<tr>
<td>海光7280(8 numa node)</td>
<td>numa0    106.839<br>numa1    168.583<br>numa2    163.925<br>numa3    163.690<br>numa4    289.628<br>numa5    288.632<br>numa6    236.615<br>numa7    291.880<br>分割行<br>enabled die interleaving <br>core:0 153.005<br>core:16 152.458<br>core:32 272.057<br>core:48 269.441</td>
</tr>
<tr>
<td>海光5280(4 numa node)</td>
<td>core:0   102.574<br>core:8   160.989<br>core:16  286.850<br>core:24  231.197</td>
</tr>
<tr>
<td>Intel 8269CY(2 numa node)</td>
<td>core:0        69.792<br>core:26      93.107</td>
</tr>
<tr>
<td>申威3231(2numa node)</td>
<td>core:0     215.146<br>core:32   282.443</td>
</tr>
<tr>
<td>倚天710（2Die）</td>
<td>133ns 205ns （待测）</td>
</tr>
</tbody>
</table>
<p>测试命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">for i in $(seq 0 8 127); do echo core:$i; numactl -C $i -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 64M; done &gt;lat.log 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>测试结果和numactl -H 看到的node distance完全一致，芯片厂家应该就是这样测试然后把这个延迟当做距离写进去了</p>
<h3 id="龙芯测试数据"><a href="#龙芯测试数据" class="headerlink" title="龙芯测试数据"></a>龙芯测试数据</h3><p>3A5000为龙芯，执行的命令为./lat_mem_rd 128M 4096，其中 4096 参数为跳步大小。其基本原理是，通过按 给定间隔去循环读一定大小的内存区域，测量每个读平均的时间。如果区域大小小于 L1 Cache 大 小，时间应该接近 L1 的访问延迟;如果大于 L1 小于 L2，则接近 L2 访问延迟;依此类推。图中横坐 标为访问的字节数，纵坐标为访存的拍数(cycles)。</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221113929547.png" alt="image-20220221113929547"></p>
<p>基于跳步访问的 3A5000 和 Zen1、Skylake 各级延迟的比较(cycles)</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112527936.png" alt="image-20220221112527936"></p>
<p>下图给出了 LMbench 测试得到的访存操作的并发性，执行的命令为./par_mem。访存操作的并 发性是各级 Cache 和内存所支持并发访问的能力。在 LMbench 中，访存操作并发性的测试是设计一 个链表，不断地遍历访问下一个链表中的元素，链表所跳的距离和需要测量的 Cache 容量相关，在 一段时间能并发的发起对链表的追逐操作，也就是同时很多链表在遍历，如果发现这一段时间内 能同时完成 N 个链表的追逐操作，就认为访存的并发操作是 N。</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112727377.png" alt="image-20220221112727377"></p>
<p>下图列出了三款处理器的功能部件操作延迟数据，使用的命令是./lat_ops。</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221112853404.png" alt="image-20220221112853404"></p>
<h4 id="龙芯stream数据"><a href="#龙芯stream数据" class="headerlink" title="龙芯stream数据"></a>龙芯stream数据</h4><p>LMbench 包含了 STREAM 带宽测试工具，可以用来测试可持续的内存访问带宽情况。图表12.25列 出了三款处理器的 STREAM 带宽数据，其中 STREAM 数组大小设置为 1 亿个元素，采用 OpenMP 版本 同时运行四个线程来测试满载带宽;相应测试平台均为 CPU 的两个内存控制器各接一根内存条， 3A5000 和 Zen1 用 DDR4 3200 内存条，Skylake 用 DDR4 2400 内存条(它最高只支持这个规格)。</p>
<p><img src="https://plantegg.oss-cn-beijing.aliyuncs.com/images/951413iMgBlog/image-20220221113037332.png" alt="image-20220221113037332"></p>
<p>从数据可以看到，虽然硬件上 3A5000 和 Zen1 都实现了 DDR4 3200，但 3A5000 的实测可持续带宽 还是有一定差距。用户程序看到的内存带宽不仅仅和内存的物理频率有关系，也和处理器内部的 各种访存队列、内存控制器的调度策略、预取器和内存时序参数设置等相关，需要进行更多分析 来定位具体的瓶颈点。像 STREAM 这样的软件测试工具，能够更好地反映某个子系统的综合能力， 因而被广泛采用。</p>
<h2 id="对比结论"><a href="#对比结论" class="headerlink" title="对比结论"></a>对比结论</h2><ul>
<li>AMD单核跑分数据比较好</li>
<li>MySQL 查询场景下Intel的性能好很多</li>
<li>xdb比社区版性能要好</li>
<li>MySQL8.0比5.7在多核锁竞争场景下性能要好</li>
<li>intel最好，AMD接近Intel，海光差的比较远但是又比鲲鹏好很多，飞腾最差，尤其是跨socket简直是灾难</li>
<li>麒麟OS性能也比CentOS略差一些</li>
</ul>
<p>整体来说AMD用领先了一代的工艺（7nm VS 14nm)，在MySQL查询场景中终于可以接近Intel了，但是海光、鲲鹏、飞腾还是不给力。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="/2021/06/01/CPU的制造和概念/">CPU的制造和概念</a></p>
<p><a href="/2021/05/16/CPU Cache Line 和性能/">CPU 性能和Cache Line</a></p>
<p><a href="/2021/05/16/Perf IPC以及CPU利用率/">Perf IPC以及CPU性能</a></p>
<p><a href="/2021/06/18/几款CPU性能对比/">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></p>
<p><a href="/2021/05/15/飞腾ARM芯片(FT2500">飞腾ARM芯片(FT2500)的性能测试</a>的性能测试/)</p>
<p><a href="/2021/05/14/十年后数据库还是不敢拥抱NUMA/">十年后数据库还是不敢拥抱NUMA？</a></p>
<p><a href="/2021/03/07/一次海光物理机资源竞争压测的记录/">一次海光物理机资源竞争压测的记录</a></p>
<p><a href="/2019/12/16/Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的/">Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</a></p>
<p><a href="https://blog.csdn.net/xuanjian_bjtu/article/details/107178226" target="_blank" rel="external">lmbench测试要考虑cache等</a> </p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/海光/" rel="tag"># 海光</a>
          
            <a href="/tags/超线程/" rel="tag"># 超线程</a>
          
            <a href="/tags/ADM/" rel="tag"># ADM</a>
          
            <a href="/tags/Zen/" rel="tag"># Zen</a>
          
            <a href="/tags/hygon/" rel="tag"># hygon</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/11/26/数据库计算向量化/" rel="next" title="数据库计算向量化">
                <i class="fa fa-chevron-left"></i> 数据库计算向量化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/01/15/记一次听风扇声音来定位性能/" rel="prev" title="听风扇声音来定位性能瓶颈">
                听风扇声音来定位性能瓶颈 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="weibo @plantegg" />
          <p class="site-author-name" itemprop="name">weibo @plantegg</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">135</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">231</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#不同CPU性能大PK"><span class="nav-number">1.</span> <span class="nav-text">不同CPU性能大PK</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参与比较的几款CPU参数"><span class="nav-number">1.2.</span> <span class="nav-text">参与比较的几款CPU参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hygon-7280"><span class="nav-number">1.2.1.</span> <span class="nav-text">Hygon 7280</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AMD-EPYC-7H12"><span class="nav-number">1.2.2.</span> <span class="nav-text">AMD EPYC 7H12</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intel-8163"><span class="nav-number">1.2.3.</span> <span class="nav-text">Intel 8163</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#鲲鹏920"><span class="nav-number">1.2.4.</span> <span class="nav-text">鲲鹏920</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#飞腾2500"><span class="nav-number">1.2.5.</span> <span class="nav-text">飞腾2500</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单核以及HT计算Prime性能比较"><span class="nav-number">1.3.</span> <span class="nav-text">单核以及HT计算Prime性能比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对比MySQL-sysbench和tpcc性能"><span class="nav-number">1.4.</span> <span class="nav-text">对比MySQL sysbench和tpcc性能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sysbench点查"><span class="nav-number">1.4.1.</span> <span class="nav-text">sysbench点查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysqld-二进制代码所在-page-cache带来的性能影响"><span class="nav-number">1.4.2.</span> <span class="nav-text">Mysqld 二进制代码所在 page cache带来的性能影响</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网卡以及node距离带来的性能差异"><span class="nav-number">1.4.3.</span> <span class="nav-text">网卡以及node距离带来的性能差异</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#网卡软中断以及网卡远近的测试结论"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">网卡软中断以及网卡远近的测试结论</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tpcc-1000仓"><span class="nav-number">1.4.4.</span> <span class="nav-text">tpcc 1000仓</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三款CPU的性能指标"><span class="nav-number">1.5.</span> <span class="nav-text">三款CPU的性能指标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在lmbench上的测试数据"><span class="nav-number">1.6.</span> <span class="nav-text">在lmbench上的测试数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#飞腾2500-1"><span class="nav-number">1.6.1.</span> <span class="nav-text">飞腾2500</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#鲲鹏920-1"><span class="nav-number">1.6.2.</span> <span class="nav-text">鲲鹏920</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#海光7280"><span class="nav-number">1.6.3.</span> <span class="nav-text">海光7280</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hygon5280测试数据"><span class="nav-number">1.6.4.</span> <span class="nav-text">hygon5280测试数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#intel-8269CY"><span class="nav-number">1.6.5.</span> <span class="nav-text">intel 8269CY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intel-R-Xeon-R-CPU-E5-2682-v4"><span class="nav-number">1.6.6.</span> <span class="nav-text">Intel(R) Xeon(R) CPU E5-2682 v4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stream对比数据"><span class="nav-number">1.6.7.</span> <span class="nav-text">stream对比数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lat-mem-rd对比数据"><span class="nav-number">1.6.8.</span> <span class="nav-text">lat_mem_rd对比数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#龙芯测试数据"><span class="nav-number">1.6.9.</span> <span class="nav-text">龙芯测试数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#龙芯stream数据"><span class="nav-number">1.6.9.1.</span> <span class="nav-text">龙芯stream数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对比结论"><span class="nav-number">1.7.</span> <span class="nav-text">对比结论</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.8.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">weibo @plantegg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv_footer"></span>次
</span>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv_footer"></span>人次
</span>


        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
